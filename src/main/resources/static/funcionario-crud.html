<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Estratégica Engenharia - Funcionários</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/inicio.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
</head>
<body>
<div class="layout">
    <aside class="sidebar">
        <div class="logo">
            <a href="/inicio.html">
                <img src="/media/imagens/estrategicalogo.png" alt="Logo Estratégica Engenharia" class="logo-img">
            </a>
        </div>
        <nav class="nav">
            <a href="/contrato-crud.html"><i class="fas fa-file-contract"></i> Contrato</a>
            <a href="/cliente-crud.html"><i class="fas fa-user"></i> Cliente</a>
            <a href="/atividade-info.html"><i class="fas fa-tasks"></i> Atividade</a>
            <a href="/users-info.html"><i class="fas fa-users-cog"></i> Usuários</a>
            <a href="/gestor-crud.html"><i class="fas fa-user-tie"></i> Gestor</a>
            <a href="/funcionario-crud.html"><i class="fas fa-user-friends"></i> Funcionários</a>
            <a href="/apontamento-crud.html"><i class="fas fa-clipboard-list"></i> Apontamento</a>
            <a href="/escala-de-trabalho-crud.html"><i class="fas fa-calendar-alt"></i> Escala de Trabalho</a>
            <a href="/funcionario-escala-crud.html"><i class="fas fa-user-clock"></i> Funcionários Escala</a>
            <a href="/feriado-crud.html"><i class="fas fa-umbrella-beach"></i> Feriados</a>
        </nav>
    </aside>
    <main class="content">
        <h1 class="mb-4 text-center" style="color:#ff9800;">Lista de Funcionários</h1>
        <div class="text-center mb-4">
            <button class="btn btn-outline-primary" onclick="carregarFuncionarios()">Atualizar Lista</button>
            <button class="btn btn-outline-success ms-2" onclick="carregarRelatorio()">Relatório de Produtividade</button>
        </div>
        <div id="listaFuncionarios" class="card shadow-sm mb-5" style="max-width:700px; margin:0 auto;">
            <div class="card-header bg-secondary text-white">Funcionários Cadastrados</div>
            <ul class="list-group list-group-flush" id="funcionarioList">
                <!-- Funcionários serão inseridos aqui -->
            </ul>
        </div>
        <div id="relatorioProdutividade" class="card shadow-sm mb-5" style="display:none; max-width:1000px; margin:0 auto;">
            <div class="card-header bg-info text-white">Relatório de Produtividade</div>
            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Total de Horas por Mês</th>
                            <th>Média Horas/Dia</th>
                            <th>Nº Atividades</th>
                            <th>Gestor Responsável</th>
                            <th>Cliente do Contrato</th>
                        </tr>
                    </thead>
                    <tbody id="relatorioBody"></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<script>
    const apiUrl = "http://localhost:8081/funcionario";

    function carregarFuncionarios() {
        fetch(apiUrl)
            .then(res => res.json())
            .then(data => {
                const funcionarioList = document.getElementById("funcionarioList");
                funcionarioList.innerHTML = "";

                data.forEach(funcionario => {
                    const li = document.createElement("li");
                    li.className = "list-group-item";
                    li.innerHTML = `
                        <strong>ID:</strong> ${funcionario.id_funcionario} |
                        <strong>Nome:</strong> ${funcionario.nome} |
                        <strong>ID Usuário:</strong> ${funcionario.fk_users_id_user}
                    `;
                    funcionarioList.appendChild(li);
                });
            });
        document.getElementById("relatorioProdutividade").style.display = "none";
    }

    function carregarRelatorio() {
        fetch(apiUrl + "/relatorio-produtividade")
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById("relatorioBody");
                tbody.innerHTML = "";
                data.forEach(item => {
                    const horasMes = Object.entries(item.horasPorMes)
                        .map(([mes, horas]) => `<div>${mes}: <b>${horas.toFixed(2)}h</b></div>`).join("");
                    const tr = document.createElement("tr");
                    tr.innerHTML = `
                        <td>${item.nomeFuncionario}</td>
                        <td>${horasMes}</td>
                        <td>${item.mediaHorasPorDia}</td>
                        <td>${item.numeroAtividades}</td>
                        <td>${item.gestorResponsavel ?? '-'}</td>
                        <td>${item.clienteContrato ?? '-'}</td>
                    `;
                    tbody.appendChild(tr);
                });
                document.getElementById("relatorioProdutividade").style.display = "";
            });
    }

    // Carrega a lista ao abrir a página
    window.onload = carregarFuncionarios;
</script>

</body>
</html>
